<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Unkown Game Demo</title>
  <style>
    body { margin: 0; overflow: hidden; background: #000; }
    canvas { display: block; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/controls/PointerLockControls.js"></script>
</head>
<body>
<script>
// Scene basics
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 2000);
const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Lighting
const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444, 1.0);
hemiLight.position.set(0, 200, 0);
scene.add(hemiLight);

const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
dirLight.position.set(100, 200, 100);
scene.add(dirLight);

// Ground (green with pixel-like grass variation)
const groundSize = 512;
const groundGeometry = new THREE.PlaneGeometry(groundSize, groundSize, 64, 64);
const groundCanvas = document.createElement('canvas');
groundCanvas.width = 128;
groundCanvas.height = 128;
const ctx = groundCanvas.getContext('2d');
ctx.fillStyle = '#1d8238';
ctx.fillRect(0, 0, 128, 128);
for (let i=0; i<500; i++) {
  ctx.fillStyle = Math.random() > 0.5 ? '#1c7a34' : '#1f883a';
  ctx.fillRect(Math.random()*128, Math.random()*128, 2, 2);
}
const groundTexture = new THREE.CanvasTexture(groundCanvas);
const groundMaterial = new THREE.MeshLambertMaterial({ map: groundTexture });
const ground = new THREE.Mesh(groundGeometry, groundMaterial);
ground.rotation.x = -Math.PI / 2;
scene.add(ground);

// Player controls setup
const controls = new THREE.PointerLockControls(camera, renderer.domElement);
document.body.addEventListener('click', () => controls.lock());

// Movement vars
const keys = {};
let moveSpeed = 5;
let sprintMultiplier = 2;
let velocity = new THREE.Vector3();
let direction = new THREE.Vector3();
let canJump = false;

// Camera view cycle: 0=first,1=third behind,2=third front
let viewMode = 0;
const thirdPersonDistance = 5;

// Key events
document.addEventListener('keydown', (e) => {
  keys[e.code] = true;
  if (e.code === 'F4') {
    viewMode = (viewMode + 1) % 3;
  }
});

document.addEventListener('keyup', (e) => {
  keys[e.code] = false;
});

// Animate loop
const clock = new THREE.Clock();
function animate() {
  requestAnimationFrame(animate);
  const delta = clock.getDelta();

  velocity.set(0,0,0);
  direction.set(0,0,0);

  let speed = moveSpeed;
  if (keys['ShiftLeft'] || keys['ShiftRight']) speed *= sprintMultiplier;

  if (keys['KeyW'] || keys['KeyI']) direction.z -= 1;
  if (keys['KeyS'] || keys['KeyK']) direction.z += 1;
  if (keys['KeyA'] || keys['KeyJ']) direction.x -= 1; // fixed J
  if (keys['KeyD'] || keys['KeyL']) direction.x += 1; // fixed L

  direction.normalize();

  if (controls.isLocked) {
    velocity.x = direction.x * speed * delta;
    velocity.z = direction.z * speed * delta;

    controls.moveRight(velocity.x);
    controls.moveForward(velocity.z);
  }

  // Handle camera view modes
  if (viewMode === 0) {
    // first person (default)
    camera.position.copy(controls.getObject().position);
  } else if (viewMode === 1) {
    // third person behind
    const offset = new THREE.Vector3(0, 2, thirdPersonDistance);
    offset.applyQuaternion(camera.quaternion);
    camera.position.copy(controls.getObject().position).sub(offset);
    camera.lookAt(controls.getObject().position);
  } else if (viewMode === 2) {
    // third person front
    const offset = new THREE.Vector3(0, 2, -thirdPersonDistance);
    offset.applyQuaternion(camera.quaternion);
    camera.position.copy(controls.getObject().position).sub(offset);
    camera.lookAt(controls.getObject().position);
  }

  renderer.render(scene, camera);
}
animate();

</script>
</body>
</html>
